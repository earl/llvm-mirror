## This tests that the umask is respected when
## assigning permissions of output files.

## Windows has no umask so this test makes no sense, nor would
## it work because there is no umask(1) in a Windows environment
# UNSUPPORTED: system-windows

# RUN: touch %t
# RUN: chmod 0755 %t
# RUN: ls -l %t | cut -f 1 -d ' ' > %t.0755
# RUN: chmod 0500 %t
# RUN: ls -l %t | cut -f 1 -d ' ' > %t.0500
# RUN: chmod 0555 %t
# RUN: ls -l %t | cut -f 1 -d ' ' > %t.0555

# RUN: yaml2obj %s -o %t

# RUN: umask 0022
# RUN: chmod 0777 %t
# RUN: llvm-objcopy %t %t1
# RUN: ls -l %t1 | cut -f 1 -d ' ' > %t1.perms
# RUN: cmp %t1.perms %t.0755

# RUN: umask 0237
# RUN: chmod 0707 %t
# RUN: llvm-objcopy %t %t1
# RUN: ls -l %t1 | cut -f 1 -d ' ' > %t1.perms
# RUN: cmp %t1.perms %t.0500

# RUN: umask 0222
# RUN: chmod 0777 %t
# RUN: llvm-objcopy %t %t1
# RUN: ls -l %t1 | cut -f 1 -d ' ' > %t1.perms
# RUN: cmp %t1.perms %t.0555


--- !ELF
FileHeader:
  Class:   ELFCLASS64
  Data:    ELFDATA2LSB
  Type:    ET_EXEC
  Machine: EM_X86_64
