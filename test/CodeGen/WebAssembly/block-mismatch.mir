# RUN: not llc -mtriple=wasm32-unknown-unknown -start-after xray-instrumentation %s -o /dev/null 2>&1 | FileCheck %s

# This tests if there are block/loop marker mismatches, the program crashes.

---
name: block_mismatch
liveins:
  - { reg: '$arguments', reg: '$value_stack' }
tracksRegLiveness: true
body: |
  bb.0:
    liveins: $arguments, $value_stack
    BLOCK 64, implicit-def $value_stack, implicit $value_stack
    END_BLOCK implicit-def $value_stack, implicit $value_stack
    ; CHECK: LLVM ERROR: END marker mismatch!
    END_BLOCK implicit-def $value_stack, implicit $value_stack
    RETURN_VOID implicit-def dead $arguments
...
